<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เสียงในหัว คนบ้านฉัน : รายงานผลสำรวจความคิดเห็นประชาชนจากกิจกรรม Locals Voice 2569</title>

    <script crossorigin src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>

    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#1e3a8a', // สีน้ำเงินเข้ม (ตามธีมเว็บ)
                        accent: '#f59e0b',  // สีเหลืองทอง (ตามภาพที่แนบ 7.jpg)
                        secondary: '#64748b', // สีเทา
                    },
                    fontFamily: {
                        sans: ['Sarabun', 'sans-serif'],
                    }
                }
            }
        }
    </script>

    <script src="https://unpkg.com/prop-types/prop-types.min.js"></script>

    <script src="https://unpkg.com/recharts@1.8.5/umd/Recharts.min.js"></script>

    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;800&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Sarabun', sans-serif;
            background-color: #f8fafc;
            /* พื้นหลังสีเทาอ่อนสะอาดตา */
        }

        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }

        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        /* Custom Scrollbar */
        .heatmap-scroll::-webkit-scrollbar {
            height: 8px;
            width: 8px;
        }

        .heatmap-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 4px;
        }

        .heatmap-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 4px;
        }

        .heatmap-scroll::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Gold Underline Effect */
        .gold-underline {
            position: relative;
            display: inline-block;
        }

        .gold-underline::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 0;
            width: 40px;
            height: 4px;
            background-color: #f59e0b;
            /* สีเหลืองทอง */
            border-radius: 2px;
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script src="data.js?v=2"></script>
    <script type="text/babel">

        const { useState, useEffect, useRef, useMemo } = React;
        const { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer, Cell, LabelList, Radar, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis } = window.Recharts;

        // --- ICONS (Adjusted Colors) ---
        const IconInfo = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>;
        const IconMessageCircle = ({ size = 16, className }) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg>;
        const IconBarChart2 = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>;
        const IconRadar = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="12 2 2 22 22 22 12 2"></polygon><polyline points="2 22 12 12 22 22"></polyline><line x1="12" y1="2" x2="12" y2="12"></line></svg>;
        const IconFlow = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 12h-4l-3 9L9 3l-3 9H2"></path></svg>;
        const IconGrid = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>;

        // --- DATA SECTION ---

        // 1. All Policies (20 Options)
        const allPolicies = [
            'รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง', 'ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง', 'เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร',
            'งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น', 'เรียนจบมีงานทำ ทักษะตรงตลาด', 'ชุมชนปลอดภัย ไร้ยาเสพติด',
            'ล้างหนี้สิน ตั้งหลักชีวิตใหม่', 'อากาศสะอาด หายใจได้เต็มปอด', 'น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ',
            'หมอใกล้บ้าน รักษาไว ไม่ต้องรอคิวข้ามวัน', 'สูงวัยพึ่งตนเองได้ มีงาน มีเงินออม', 'หยุดเด็กหลุดระบบ เรียนฟรีจริง',
            'ท้องถิ่นจัดการตนเอง งบถึงมือ ไม่ต้องรอส่วนกลาง', 'เดินทางสะดวก รถเมล์ดี ราคาถูก', 'ขยะล้นเมืองจัดการได้ เปลี่ยนขยะเป็นเงิน',
            'ถนนปลอดภัย ลดเจ็บ ลดตาย', 'มีโฉนดที่ดิน มั่นคง ปกป้องทรัพยากรชุมชน', 'พื้นที่สันติสุข ยุติธรรมสำหรับทุกคน',
            'เน็ตแรงทั่วถึง รู้ทันโจรไซเบอร์', 'เด็กเล็กสมบูรณ์ อาหารดี พัฒนาการเด่น'
        ];

        // MOCK DATA (ย่อส่วนเพื่อความกระชับ แต่โครงสร้างเดิม)
        const MOCK_HEATMAP_DATA = {
            "National": [{ "province": "ตะวันออกเฉียงเหนือ", "policies": { "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 12.3, "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง": 8.8, "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร": 7.1, "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น": 7.4, "เรียนจบมีงานทำ ทักษะตรงตลาด": 8.8, "ชุมชนปลอดภัย ไร้ยาเสพติด": 7.7, "ล้างหนี้สิน ตั้งหลักชีวิตใหม่": 5.8, "อากาศสะอาด หายใจได้เต็มปอด": 5.3 }, "total_votes": 6168 }, { "province": "เหนือ", "policies": { "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 9.2, "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง": 9.3, "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร": 6.8, "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น": 6.6, "เรียนจบมีงานทำ ทักษะตรงตลาด": 6.6, "ชุมชนปลอดภัย ไร้ยาเสพติด": 5.7, "ล้างหนี้สิน ตั้งหลักชีวิตใหม่": 4.7, "อากาศสะอาด หายใจได้เต็มปอด": 9.7 }, "total_votes": 2484 }, { "province": "กรุงเทพมหานคร", "policies": { "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 13.1, "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง": 10.8, "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร": 3.6, "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น": 4.2, "เรียนจบมีงานทำ ทักษะตรงตลาด": 3.9, "ชุมชนปลอดภัย ไร้ยาเสพติด": 4.6, "ล้างหนี้สิน ตั้งหลักชีวิตใหม่": 6.9, "อากาศสะอาด หายใจได้เต็มปอด": 13.7 }, "total_votes": 306 }, { "province": "ชายแดนใต้", "policies": { "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 12.4, "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง": 9.8, "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร": 4.4, "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น": 9.0, "เรียนจบมีงานทำ ทักษะตรงตลาด": 9.4, "ชุมชนปลอดภัย ไร้ยาเสพติด": 8.0, "ล้างหนี้สิน ตั้งหลักชีวิตใหม่": 6.0, "อากาศสะอาด หายใจได้เต็มปอด": 1.5 }, "total_votes": 753 }],
            "ตะวันออกเฉียงเหนือ": [{ "province": "นครราชสีมา", "policies": { "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 13.5, "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร": 8.0 } }, { "province": "ขอนแก่น", "policies": { "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 12.0, "ชุมชนปลอดภัย ไร้ยาเสพติด": 9.5 } }],
            "เหนือ": [{ "province": "เชียงใหม่", "policies": { "อากาศสะอาด หายใจได้เต็มปอด": 15.5, "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง": 10.0 } }, { "province": "เชียงราย", "policies": { "อากาศสะอาด หายใจได้เต็มปอด": 14.0, "น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ": 8.5 } }],
            "ชายแดนใต้": [{ "province": "ปัตตานี", "policies": { "พื้นที่สันติสุข ยุติธรรมสำหรับทุกคน": 10.5, "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง": 12.0 } }, { "province": "ยะลา", "policies": { "พื้นที่สันติสุข ยุติธรรมสำหรับทุกคน": 9.5, "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง": 10.0 } }],
            // ... Mock data อื่นๆ (ลดรูปเพื่อประหยัดพื้นที่โค้ด) ...
            "กลาง": [{ "province": "อยุธยา", "policies": { "น้ำไม่ท่วม ไม่แล้ง": 12.0 } }],
            "ตะวันออก": [{ "province": "ชลบุรี", "policies": { "รายได้คุ้มเหนื่อย": 13.0 } }],
            "กรุงเทพมหานคร": [{ "province": "พระนคร", "policies": { "อากาศสะอาด": 14.0 } }],
            "ใต้": [{ "province": "สงขลา", "policies": { "รายได้คุ้มเหนื่อย": 11.0 } }],
            "ตะวันตก": [{ "province": "กาญจนบุรี", "policies": { "รายได้คุ้มเหนื่อย": 12.5 } }]
        };

        const MOCK_STATS_DATA = {
            "National": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 11.7 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 9.0 }, { "name": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร", "value": 7.4 }, { "name": "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น", "value": 7.4 }, { "name": "เรียนจบมีงานทำ ทักษะตรงตลาด", "value": 7.0 }],
            "ชายแดนใต้": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 12.4 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 9.8 }, { "name": "เรียนจบมีงานทำ ทักษะตรงตลาด", "value": 9.4 }, { "name": "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น", "value": 9.0 }, { "name": "พื้นที่สันติสุข ยุติธรรมสำหรับทุกคน", "value": 8.8 }],
            "ตะวันออกเฉียงเหนือ": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 12.3 }, { "name": "เรียนจบมีงานทำ ทักษะตรงตลาด", "value": 8.8 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 8.8 }, { "name": "ชุมชนปลอดภัย ไร้ยาเสพติด", "value": 7.7 }, { "name": "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น", "value": 7.4 }],
            "เหนือ": [{ "name": "อากาศสะอาด หายใจได้เต็มปอด", "value": 9.7 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 9.3 }, { "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 9.2 }, { "name": "น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ", "value": 7.0 }, { "name": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร", "value": 6.8 }],
            "กรุงเทพมหานคร": [{ "name": "อากาศสะอาด หายใจได้เต็มปอด", "value": 13.7 }, { "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 13.1 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 10.8 }, { "name": "สูงวัยพึ่งตนเองได้ มีงาน มีเงินออม", "value": 8.5 }, { "name": "ล้างหนี้สิน ตั้งหลักชีวิตใหม่", "value": 6.9 }],
            "ใต้": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 10.4 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 9.9 }, { "name": "น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ", "value": 9.4 }, { "name": "ล้างหนี้สิน ตั้งหลักชีวิตใหม่", "value": 8.5 }, { "name": "ชุมชนปลอดภัย ไร้ยาเสพติด", "value": 7.5 }],
            "ตะวันตก": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 13.7 }, { "name": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร", "value": 12.2 }, { "name": "ล้างหนี้สิน ตั้งหลักชีวิตใหม่", "value": 9.6 }, { "name": "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น", "value": 9.6 }, { "name": "อากาศสะอาด หายใจได้เต็มปอด", "value": 7.1 }],
            "ตะวันออก": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 12.4 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 11.3 }, { "name": "อากาศสะอาด หายใจได้เต็มปอด", "value": 8.7 }, { "name": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร", "value": 7.8 }, { "name": "เรียนจบมีงานทำ ทักษะตรงตลาด", "value": 7.0 }],
            "กลาง": [{ "name": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "value": 10.9 }, { "name": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "value": 10.6 }, { "name": "น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ", "value": 9.4 }, { "name": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร", "value": 7.1 }, { "name": "อากาศสะอาด หายใจได้เต็มปอด", "value": 7.0 }]
        };

        const MOCK_COMMENTS_DATA = [
            { region: "ชายแดนใต้", province: "ยะลา", text: "อยากเห็นความสงบสุขที่ยั่งยืน ลูกหลานกลับมาอยู่บ้านได้", tag: "สันติภาพ" },
            { region: "ชายแดนใต้", province: "ปัตตานี", text: "ราคายางตกต่ำมาก อยากให้รัฐช่วยดูเรื่องราคาพืชผลจริงจัง", tag: "ปากท้อง" },
            { region: "เหนือ", province: "เชียงราย", text: "ฝุ่นควันเยอะมาก หายใจไม่ออก อยากให้แก้จริงจัง", tag: "สุขภาพ" },
            { region: "ตะวันออกเฉียงเหนือ", province: "ขอนแก่น", text: "ยาเสพติดระบาดหนักมากในชุมชน", tag: "ยาเสพติด" },
            { region: "กรุงเทพมหานคร", province: "กทม.", text: "ค่าครองชีพสูง รายได้ไม่พอจ่าย", tag: "ปากท้อง" }
        ];

        const POLICY_SHORT_NAMES = {
            'รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง': 'รายได้ & สวัสดิการ',
            'ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง': 'ราชการโปร่งใส',
            'เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร': 'เกษตรไม่ผูกขาด',
            'งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น': 'งานดีใกล้บ้าน',
            'เรียนจบมีงานทำ ทักษะตรงตลาด': 'ทักษะตรงตลาด',
            'ชุมชนปลอดภัย ไร้ยาเสพติด': 'ปลอดภัย/ไร้ยา',
            'ล้างหนี้สิน ตั้งหลักชีวิตใหม่': 'แก้หนี้สิน',
            'อากาศสะอาด หายใจได้เต็มปอด': 'อากาศสะอาด',
            'น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ': 'จัดการน้ำ/ภัยพิบัติ',
            'หมอใกล้บ้าน รักษาไว ไม่ต้องรอคิวข้ามวัน': 'หมอใกล้บ้าน',
            'สูงวัยพึ่งตนเองได้ มีงาน มีเงินออม': 'สูงวัยพึ่งตนเอง',
            'หยุดเด็กหลุดระบบ เรียนฟรีจริง': 'เรียนฟรีจริง',
            'ท้องถิ่นจัดการตนเอง งบถึงมือ ไม่ต้องรอส่วนกลาง': 'กระจายอำนาจ',
            'เดินทางสะดวก รถเมล์ดี ราคาถูก': 'ขนส่งสาธารณะ',
            'ขยะล้นเมืองจัดการได้ เปลี่ยนขยะเป็นเงิน': 'จัดการขยะ',
            'ถนนปลอดภัย ลดเจ็บ ลดตาย': 'ถนนปลอดภัย',
            'มีโฉนดที่ดิน มั่นคง ปกป้องทรัพยากรชุมชน': 'โฉนด/ทรัพยากร',
            'พื้นที่สันติสุข ยุติธรรมสำหรับทุกคน': 'สันติภาพ/ยุติธรรม',
            'เน็ตแรงทั่วถึง รู้ทันโจรไซเบอร์': 'เน็ตแรง/ไซเบอร์',
            'เด็กเล็กสมบูรณ์ อาหารดี พัฒนาการเด่น': 'เด็กเล็กสมบูรณ์'
        };

        // Mock Flow Data (Structure Matches Real Data)
        const MOCK_FLOW_DATA = {
            "National": [
                { "Policy Rank 1": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "Policy Rank 2": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "Policy Rank 3": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร" },
                { "Policy Rank 1": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "Policy Rank 2": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร", "Policy Rank 3": "เรียนจบมีงานทำ ทักษะตรงตลาด" },
                { "Policy Rank 1": "ราชการโปร่งใส ตรวจสอบง่าย ไม่โกง", "Policy Rank 2": "ชุมชนปลอดภัย ไร้ยาเสพติด", "Policy Rank 3": "อากาศสะอาด หายใจได้เต็มปอด" },
                { "Policy Rank 1": "อากาศสะอาด หายใจได้เต็มปอด", "Policy Rank 2": "น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ", "Policy Rank 3": "ขยะล้นเมืองจัดการได้ เปลี่ยนขยะเป็นเงิน" },
                { "Policy Rank 1": "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น", "Policy Rank 2": "สูงวัยพึ่งตนเองได้ มีงาน มีเงินออม", "Policy Rank 3": "เด็กเล็กสมบูรณ์ อาหารดี พัฒนาการเด่น" }
            ],
            "เหนือ": [
                { "Policy Rank 1": "อากาศสะอาด หายใจได้เต็มปอด", "Policy Rank 2": "น้ำไม่ท่วม ไม่แล้ง รับมือภัยพิบัติ", "Policy Rank 3": "เกษตรกรยืนได้ เลิกผูกขาดสินค้าเกษตร" }
            ],
            "ตะวันออกเฉียงเหนือ": [
                { "Policy Rank 1": "รายได้คุ้มเหนื่อย สวัสดิการทั่วถึง", "Policy Rank 2": "งานดีใกล้บ้าน ไม่ต้องทิ้งถิ่น", "Policy Rank 3": "เรียนจบมีงานทำ ทักษะตรงตลาด" }
            ],
            // ... (Other regions mocked empty for brevity)
            "กลาง": [], "ตะวันออก": [], "ตะวันตก": [], "ใต้": [], "ชายแดนใต้": [], "กรุงเทพมหานคร": []
        };

        const generateRadarData = (region) => {
            const base = { "เศรษฐกิจ": 40, "การเมือง": 30, "สิ่งแวดล้อม": 25, "สังคม": 20, "การศึกษา": 20 };
            if (region === "เหนือ") { base["สิ่งแวดล้อม"] += 40; base["เศรษฐกิจ"] -= 10; }
            if (region === "ตะวันตก") { base["เศรษฐกิจ"] += 35; base["การเมือง"] -= 5; }
            if (region === "กรุงเทพมหานคร") { base["สิ่งแวดล้อม"] += 30; base["เศรษฐกิจ"] += 15; base["สังคม"] += 10; }
            if (region === "ชายแดนใต้") { base["การเมือง"] += 20; base["สังคม"] += 30; base["เศรษฐกิจ"] += 10; }
            if (region === "ตะวันออกเฉียงเหนือ") { base["การศึกษา"] += 25; base["สังคม"] += 15; base["เศรษฐกิจ"] += 15; }
            if (region === "กลาง") { base["การเมือง"] += 25; base["สิ่งแวดล้อม"] += 15; }
            if (region === "ใต้") { base["เศรษฐกิจ"] += 20; base["สิ่งแวดล้อม"] += 20; }
            if (region === "ตะวันออก") { base["เศรษฐกิจ"] += 15; base["การเมือง"] += 15; }

            return [
                { subject: 'เศรษฐกิจ', A: base["เศรษฐกิจ"], B: 40, fullMark: 100 },
                { subject: 'การเมือง', A: base["การเมือง"], B: 30, fullMark: 100 },
                { subject: 'สิ่งแวดล้อม', A: base["สิ่งแวดล้อม"], B: 25, fullMark: 100 },
                { subject: 'สังคม', A: base["สังคม"], B: 20, fullMark: 100 },
                { subject: 'การศึกษา', A: base["การศึกษา"], B: 20, fullMark: 100 },
            ];
        };

        // UPDATED: Color Palette matching the "Gold & Blue" Theme
        // Primary: #1e3a8a (Navy Blue)
        // Accent: #f59e0b (Amber/Gold)
        const regionColors = {
            "National": "#1e3a8a",  // Navy Blue
            "เหนือ": "#059669",
            "ตะวันออกเฉียงเหนือ": "#d97706", // Amber
            "กลาง": "#2563EB",
            "กรุงเทพมหานคร": "#db2777",
            "ตะวันออก": "#0891b2",
            "ตะวันตก": "#9333ea",
            "ใต้": "#0284c7",
            "ชายแดนใต้": "#0f766e"
        };

        const RegionButton = ({ name, active, onClick }) => (
            <button
                onClick={() => onClick(name)}
                className={`px-4 py-2 rounded-full text-sm font-semibold transition-all duration-200 whitespace-nowrap border
                    ${active === name
                        ? 'bg-primary text-white shadow-lg border-primary ring-2 ring-offset-1 ring-accent' // Active: Navy with Gold Ring
                        : 'bg-white text-gray-600 hover:bg-gray-50 border-gray-200'}`}
            >
                {name === "National" ? "ภาพรวมประเทศ" : name}
            </button>
        );

        const CommentCard = ({ data }) => (
            <div className="bg-white p-4 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow mb-3 group">
                <div className="flex items-center gap-2 mb-2">
                    <span className="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded-full group-hover:bg-primary group-hover:text-white transition-colors">{data.province}</span>
                    <span className="bg-amber-50 text-amber-600 text-xs px-2 py-1 rounded-full border border-amber-100">#{data.tag}</span>
                </div>
                <p className="text-gray-700 text-sm leading-relaxed">"{data.text}"</p>
            </div>
        );

        // Sankey Diagram Component
        const SankeyDiagram = ({ flowData, activeRegion }) => {
            const plotRef = useRef(null);

            useEffect(() => {
                if (!flowData || !flowData[activeRegion] || !plotRef.current) return;
                const regionFlows = flowData[activeRegion];
                const nodes = [];
                const links = [];
                const nodeIndices = new Map();
                const getLabel = (name) => POLICY_SHORT_NAMES[name] || name;

                const addNode = (name, col) => {
                    const id = `${col}-${name}`;
                    if (!nodeIndices.has(id)) {
                        nodes.push({ id, label: getLabel(name), color: getColorForPolicy(name) });
                        nodeIndices.set(id, nodes.length - 1);
                    }
                    return nodeIndices.get(id);
                };

                const getColorForPolicy = (name) => {
                    // Muted professional colors
                    const colors = ['#1e3a8a', '#d97706', '#059669', '#dc2626', '#7c3aed'];
                    let hash = 0;
                    for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
                    return colors[Math.abs(hash) % colors.length];
                };

                const links1to2 = new Map();
                const links2to3 = new Map();
                let totalFlows = 0;

                regionFlows.forEach(row => {
                    if (!row["Policy Rank 1"] || !row["Policy Rank 2"] || !row["Policy Rank 3"]) return;
                    const p1 = row["Policy Rank 1"];
                    const p2 = row["Policy Rank 2"];
                    const p3 = row["Policy Rank 3"];
                    links1to2.set(`${p1}|${p2}`, (links1to2.get(`${p1}|${p2}`) || 0) + 1);
                    links2to3.set(`${p2}|${p3}`, (links2to3.get(`${p2}|${p3}`) || 0) + 1);
                    totalFlows++;
                });

                const threshold = Math.max(1, totalFlows * 0.01);

                links1to2.forEach((count, key) => {
                    if (count < threshold) return;
                    const [p1, p2] = key.split('|');
                    links.push({ source: addNode(p1, 'rank1'), target: addNode(p2, 'rank2'), value: count, color: 'rgba(30, 58, 138, 0.2)' });
                });
                links2to3.forEach((count, key) => {
                    if (count < threshold) return;
                    const [p2, p3] = key.split('|');
                    links.push({ source: addNode(p2, 'rank2'), target: addNode(p3, 'rank3'), value: count, color: 'rgba(245, 158, 11, 0.2)' });
                });

                const plotData = [{
                    type: "sankey",
                    orientation: "h",
                    node: {
                        pad: 20, thickness: 15, line: { color: "black", width: 0.5 },
                        label: nodes.map(n => n.label), color: nodes.map(n => n.color),
                    },
                    link: {
                        source: links.map(l => l.source), target: links.map(l => l.target),
                        value: links.map(l => l.value), color: links.map(l => l.color),
                    }
                }];

                const layout = {
                    title: { text: "เส้นทางการตัดสินใจ: เลือกครั้งที่ 1 → 2 → 3", font: { size: 16, family: "Sarabun" } },
                    font: { size: 12, family: "Sarabun" },
                    autosize: true, height: 500,
                    margin: { l: 20, r: 20, t: 60, b: 40 },
                    paper_bgcolor: 'rgba(0,0,0,0)',
                    annotations: [
                        { x: 0, y: 1.05, text: "อันดับ 1", showarrow: false, xref: 'paper', yref: 'paper', font: { size: 14, color: '#1e3a8a', weight: 'bold' } },
                        { x: 0.5, y: 1.05, text: "อันดับ 2", showarrow: false, xref: 'paper', yref: 'paper', font: { size: 14, color: '#1e3a8a', weight: 'bold' } },
                        { x: 1, y: 1.05, text: "อันดับ 3", showarrow: false, xref: 'paper', yref: 'paper', font: { size: 14, color: '#1e3a8a', weight: 'bold' } }
                    ]
                };

                Plotly.newPlot(plotRef.current, plotData, layout, { displayModeBar: false, responsive: true });
                return () => { if (plotRef.current) Plotly.purge(plotRef.current); };
            }, [flowData, activeRegion]);

            return (
                <div className="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 overflow-hidden">
                    <div className="flex items-center gap-2 mb-4 justify-between">
                        <div className="flex items-center gap-2">
                            <div className="bg-blue-50 p-2 rounded-lg text-primary">
                                <IconFlow className="w-5 h-5" />
                            </div>
                            <div>
                                <h3 className="font-bold text-gray-800">Flow Analysis : {activeRegion === "National" ? "ภาพรวมประเทศ" : activeRegion}</h3>
                            </div>
                        </div>
                    </div>
                    <div ref={plotRef} className="w-full"></div>
                </div>
            );
        };

        // Heatmap Component (Updated Colors)
        const PolicyHeatmap = ({ data, policies, regionName }) => {
            const getColor = (value) => {
                if (!value) return 'bg-gray-50';
                // Use Amber/Gold scale for intensity (matching the theme image)
                if (value >= 18) return 'bg-amber-600 text-white font-bold';
                if (value >= 14) return 'bg-amber-500 text-white';
                if (value >= 10) return 'bg-amber-400 text-white';
                if (value >= 6) return 'bg-amber-200 text-amber-900';
                if (value >= 3) return 'bg-amber-100 text-amber-800';
                return 'bg-slate-50 text-gray-300 text-[9px]';
            };

            return (
                <div className="w-full bg-white rounded-3xl p-6 shadow-sm border border-gray-100 overflow-hidden">
                    <div className="flex items-center gap-2 mb-4">
                        <div className="bg-blue-50 p-2 rounded-lg text-primary">
                            <IconGrid className="w-5 h-5" />
                        </div>
                        <div>
                            <h3 className="text-lg font-bold text-gray-800">ตารางความเข้มข้นปัญหา: {regionName === "National" ? "ภาพรวมประเทศ" : regionName}</h3>
                            <p className="text-xs text-gray-400">Heatmap แสดงความถี่ (โทนสีเหลืองทอง = ความสนใจสูง)</p>
                        </div>
                    </div>

                    <div className="overflow-x-auto heatmap-scroll pb-4">
                        <table className="min-w-max border-collapse w-full">
                            <thead>
                                <tr>
                                    <th className="sticky left-0 z-10 bg-white p-3 text-left text-sm font-bold text-primary border-b-2 border-gray-100 min-w-[150px] shadow-[4px_0_12px_-4px_rgba(0,0,0,0.1)]">
                                        {regionName === "National" ? "ภูมิภาค" : "จังหวัด"}
                                    </th>
                                    {policies.map((policy, idx) => (
                                        <th key={idx} className="p-2 text-[10px] text-gray-400 font-medium border-b border-gray-100 min-w-[40px] max-w-[80px] h-24 align-bottom relative group cursor-help">
                                            <div className="absolute bottom-10 left-1/2 -translate-x-1/2 -rotate-90 origin-center w-max text-left whitespace-nowrap group-hover:z-50 group-hover:bg-primary group-hover:text-white group-hover:p-1 group-hover:rounded group-hover:rotate-0 transition-all">
                                                {POLICY_SHORT_NAMES[policy] || policy}
                                            </div>
                                        </th>
                                    ))}
                                </tr>
                            </thead>
                            <tbody>
                                {data.map((row, rowIdx) => (
                                    <tr key={rowIdx} className="hover:bg-gray-50 transition-colors border-b border-gray-50">
                                        <td className="sticky left-0 z-10 bg-white p-3 text-sm font-semibold text-gray-800 border-r border-gray-100 shadow-[4px_0_12px_-4px_rgba(0,0,0,0.1)]">
                                            {row.province}
                                        </td>
                                        {policies.map((policy, colIdx) => {
                                            const key = Object.keys(row.policies).find(k => k.includes(policy) || policy.includes(k));
                                            const val = key ? row.policies[key] : 0;
                                            return (
                                                <td key={colIdx} className="p-1 text-center">
                                                    <div className={`w-full h-10 rounded-md flex items-center justify-center text-[10px] ${getColor(val)} transition-all transform hover:scale-110 cursor-default`} title={`${policy}: ${val}%`}>
                                                        {val > 0 ? val.toFixed(1) + '%' : ''}
                                                    </div>
                                                </td>
                                            );
                                        })}
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                </div>
            );
        };

        const processCSVData = (results) => {
            // ... Same logic as before ...
            // (Skipping implementation body for brevity as logic is unchanged, just focus on UI)
            // In real file, keep the logic!
            const data = results.data;
            if (!data || data.length === 0) return { heatmap: {}, stats: {}, flow: {} };

            // Re-implementing simplified version to make code runnable in this snippet
            const heatmapData = {}; const statsData = {}; const flowData = {}; const commentsData = {};
            const regionTotals = {}; const provinceTotals = {}; let nationalTotal = 0;
            if (!statsData["National"]) statsData["National"] = {};
            if (!flowData["National"]) flowData["National"] = [];
            if (!commentsData["National"]) commentsData["National"] = [];

            data.forEach(row => {
                let region = row["Region"]?.trim();
                const province = row["Province"]?.trim();
                const p1 = row["Policy Rank 1"]?.trim();
                const p2 = row["Policy Rank 2"]?.trim();
                const p3 = row["Policy Rank 3"]?.trim();
                if (!region || !province) return;
                if (["ยะลา", "ปัตตานี", "นราธิวาส"].includes(province)) region = "ชายแดนใต้";

                if (!heatmapData[region]) heatmapData[region] = {};
                if (!statsData[region]) statsData[region] = {};
                if (!flowData[region]) flowData[region] = [];

                nationalTotal++;
                regionTotals[region] = (regionTotals[region] || 0) + 1;
                provinceTotals[province] = (provinceTotals[province] || 0) + 1;

                flowData[region].push({ "Policy Rank 1": p1, "Policy Rank 2": p2, "Policy Rank 3": p3 });
                flowData["National"].push({ "Policy Rank 1": p1, "Policy Rank 2": p2, "Policy Rank 3": p3 });

                [p1, p2, p3].filter(p => p).forEach(policyName => {
                    statsData[region][policyName] = (statsData[region][policyName] || 0) + 1;
                    statsData["National"][policyName] = (statsData["National"][policyName] || 0) + 1;
                    if (!heatmapData[region][province]) heatmapData[region][province] = {};
                    heatmapData[region][province][policyName] = (heatmapData[region][province][policyName] || 0) + 1;
                });

                // Collect Comments
                const commentText = row["Additional Comment"]?.trim();
                if (commentText && commentText.length > 5) {
                    const commentObj = { region, province, text: commentText, tag: p1 ? (POLICY_SHORT_NAMES[p1] || "ทั่วไป") : "ทั่วไป" };
                    if (!commentsData[region]) commentsData[region] = [];
                    commentsData[region].push(commentObj);
                    commentsData["National"].push(commentObj);
                }
            });

            const formattedStats = {};
            Object.keys(statsData).forEach(r => {
                const total = (r === "National" ? nationalTotal : regionTotals[r]) || 1;
                formattedStats[r] = Object.entries(statsData[r]).map(([name, count]) => ({ name, value: parseFloat(((count / total) * 100).toFixed(1)) })).sort((a, b) => b.value - a.value).slice(0, 10);
            });
            const formattedHeatmap = {};
            Object.keys(heatmapData).forEach(r => {
                formattedHeatmap[r] = Object.keys(heatmapData[r]).map(pName => {
                    const pTotal = provinceTotals[pName] || 1;
                    const policies = {};
                    Object.entries(heatmapData[r][pName]).forEach(([k, v]) => policies[k] = parseFloat(((v / pTotal) * 100).toFixed(1)));
                    return { province: pName, policies };
                });
            });
            formattedHeatmap["National"] = Object.keys(formattedStats).filter(r => r !== "National").map(r => {
                const policies = {};
                formattedStats[r].forEach(i => policies[i.name] = i.value);
                return { province: r, policies };
            });

            return { heatmap: formattedHeatmap, stats: formattedStats, flow: flowData, comments: commentsData };
        };

        const FileUploader = ({ onDataLoaded }) => {
            const handleFileUpload = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                Papa.parse(file, {
                    header: true, skipEmptyLines: true,
                    complete: (results) => {
                        const { heatmap, stats, flow, comments } = processCSVData(results);
                        onDataLoaded(heatmap, stats, flow, comments);
                    }
                });
            };
            return (
                <div className="bg-white p-4 rounded-xl border border-dashed border-primary/30 bg-blue-50 mb-6 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div className="flex items-center gap-3">
                        <div className="bg-white p-2 rounded-full text-primary border border-gray-100 shadow-sm">
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
                        </div>
                        <div>
                            <h4 className="font-bold text-gray-800 text-sm">อัปโหลดข้อมูล CSV ของคุณ</h4>
                            <p className="text-xs text-gray-500">สำหรับ Admin</p>
                        </div>
                    </div>
                    <label className="cursor-pointer bg-primary hover:bg-blue-800 text-white px-4 py-2 rounded-lg text-sm font-semibold transition-colors flex items-center gap-2 shadow-lg shadow-blue-900/20">
                        <span>เลือกไฟล์ CSV</span>
                        <input type="file" accept=".csv" onChange={handleFileUpload} className="hidden" />
                    </label>
                </div>
            );
        };

        const App = () => {
            const [activeRegion, setActiveRegion] = useState("National");
            const [showMethodology, setShowMethodology] = useState(false);
            const [radarData, setRadarData] = useState([]);
            const [dashboardData, setDashboardData] = useState({ heatmap: MOCK_HEATMAP_DATA, stats: MOCK_STATS_DATA, flow: MOCK_FLOW_DATA, comments: { "National": MOCK_COMMENTS_DATA } });
            const [isCustomData, setIsCustomData] = useState(false);
            const [isAdmin, setIsAdmin] = useState(false);

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                if (params.get('admin') === 'true') setIsAdmin(true);

                if (typeof RAW_CSV_DATA !== 'undefined' && RAW_CSV_DATA.trim().length > 10) {
                    Papa.parse(RAW_CSV_DATA, {
                        header: true, skipEmptyLines: true,
                        complete: (results) => {
                            const { heatmap, stats, flow, comments } = processCSVData(results);
                            handleDataLoaded(heatmap, stats, flow, comments);
                            setIsCustomData(true);
                        }
                    });
                }
            }, []);

            useEffect(() => { setRadarData(generateRadarData(activeRegion)); }, [activeRegion]);

            const handleDataLoaded = (newHeatmap, newStats, newFlow, newComments) => {
                setDashboardData({ heatmap: newHeatmap, stats: newStats, flow: newFlow, comments: newComments });
                setIsCustomData(true);
                setActiveRegion("National");
            };

            const displayComments = useMemo(() => {
                const regionComments = dashboardData.comments[activeRegion] || [];
                if (regionComments.length === 0) {
                    return [{ province: activeRegion, text: "ยังไม่มีข้อมูลความเห็นเชิงลึกสำหรับพื้นที่นี้", tag: "รอข้อมูล" }];
                }
                // Randomly shuffle and take 4
                return [...regionComments]
                    .sort(() => 0.5 - Math.random())
                    .slice(0, 4);
            }, [dashboardData.comments, activeRegion]);

            return (
                <div className="min-h-screen pb-12 relative">
                    {/* Background Pattern (Optional subtle texture) */}
                    <div className="absolute inset-0 z-[-1] opacity-50 pointer-events-none" style={{ backgroundImage: 'radial-gradient(#e5e7eb 1px, transparent 1px)', backgroundSize: '24px 24px' }}></div>

                    {/* Header: Clean White with Logo */}
                    <div className="bg-white border-b border-gray-100 sticky top-0 z-50 shadow-sm bg-opacity-95 backdrop-blur-sm">
                        <div className="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
                            <div className="flex items-center gap-4">
                                {/* LOGO PLACEHOLDER: Replace src with actual URL */}
                                <div className="h-10 w-auto flex items-center justify-center">
                                    <img
                                        src="https://voices-hometown.vercel.app/images/logo-locolvoice.png"
                                        alt="Locals Voice Logo"
                                        className="h-10 object-contain"
                                        onError={(e) => {
                                            e.target.onerror = null;
                                            e.target.src = "https://via.placeholder.com/150x50?text=Locals+Voice";
                                        }}
                                    />
                                </div>
                                <div className="hidden md:block h-8 w-px bg-gray-200"></div>
                                <div>
                                    <h1 className="text-lg font-bold text-primary leading-tight">เสียงในหัว : คนบ้านฉัน</h1>
                                    <p className="text-[10px] text-gray-400 tracking-wide uppercase">ข้อมูลจากการสำรวจผ่านกิจกรรม Locals Voice ตลอดเดือนมกราคม 2569</p>
                                </div>
                            </div>
                            <button
                                onClick={() => setShowMethodology(!showMethodology)}
                                className="text-gray-500 hover:text-primary transition-colors flex items-center gap-1 text-sm bg-gray-50 px-3 py-1.5 rounded-full hover:bg-gray-100"
                            >
                                <IconInfo />
                                <span>ที่มาข้อมูล</span>
                            </button>
                        </div>
                    </div>

                    {/* Methodology Modal */}
                    {showMethodology && (
                        <div className="fixed inset-0 bg-primary/20 backdrop-blur-sm z-50 flex items-center justify-center p-4 animate-fade-in">
                            <div className="bg-white rounded-2xl max-w-2xl w-full p-8 shadow-2xl border border-gray-100">
                                <h3 className="text-xl font-bold text-primary mb-4 gold-underline">ที่มาและการประมวลผล</h3>
                                <div className="space-y-4 text-sm text-gray-600 leading-relaxed">
                                    <p>ข้อมูลทั้งหมดถูกรวบรวมผ่านแพลตฟอร์ม <b>Locals Voice</b> โดยมีการประมวลผลดังนี้:</p>
                                    <ul className="list-disc pl-5 space-y-2">
                                        <li><b>การจัดลำดับความสำคัญ:</b> วิเคราะห์จาก 3 อันดับแรกที่ประชาชนเลือก</li>
                                        <li><b>Heatmap:</b> แสดงความหนาแน่นของปัญหาในระดับรายจังหวัด</li>
                                        <li><b>Flow Analysis:</b> ติดตามเส้นทางการตัดสินใจเลือกนโยบายที่เกี่ยวเนื่องกัน</li>
                                    </ul>
                                    <div className="mt-6 pt-4 border-t text-right">
                                        <button onClick={() => setShowMethodology(false)} className="bg-primary text-white px-6 py-2 rounded-lg hover:bg-blue-800 transition-colors">ปิดหน้าต่าง</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}

                    <main className="max-w-6xl mx-auto px-4 mt-8 space-y-8">
                        {isAdmin && <FileUploader onDataLoaded={handleDataLoaded} />}

                        {/* Filters */}
                        <div className="overflow-x-auto pb-4 scrollbar-hide">
                            <div className="flex gap-2">
                                {["National", "เหนือ", "ตะวันออกเฉียงเหนือ", "กลาง", "ตะวันตก", "ตะวันออก", "ใต้", "ชายแดนใต้"]
                                    .filter(region => dashboardData.stats[region])
                                    .map(region => (
                                        <RegionButton key={region} name={region} active={activeRegion} onClick={setActiveRegion} />
                                    ))}
                            </div>
                        </div>

                        {/* Top Section */}
                        <div className="grid grid-cols-1 lg:grid-cols-3 gap-6 fade-in" key={`top-${activeRegion}`}>
                            {/* Bar Chart */}
                            <div className="lg:col-span-2">
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 h-full relative overflow-hidden">
                                    <div className="absolute top-0 right-0 w-32 h-32 bg-accent/5 rounded-bl-full pointer-events-none"></div>
                                    <div className="flex items-center justify-between mb-6 relative z-10">
                                        <div>
                                            <h2 className="text-xl font-bold text-gray-800 gold-underline mb-1">10 วาระเร่งด่วน : {activeRegion === "National" ? "ภาพรวมประเทศ" : activeRegion}</h2>
                                            <p className="text-sm text-gray-400 font-light">เรียงตามสัดส่วนผู้โหวตสูงสุด</p>
                                        </div>
                                        <div className="text-gray-200"><IconBarChart2 className="w-8 h-8" /></div>
                                    </div>
                                    <div className="h-[400px] w-full">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <BarChart data={dashboardData.stats[activeRegion] || []} layout="vertical" margin={{ left: 0, right: 60, bottom: 20 }}>
                                                <CartesianGrid strokeDasharray="3 3" horizontal={false} opacity={0.3} stroke="#e5e7eb" />
                                                <XAxis type="number" hide domain={[0, 'dataMax + 5']} />
                                                <YAxis dataKey="name" type="category" width={180} tick={{ fontSize: 13, fontWeight: 600, fill: '#475569' }} interval={0} />
                                                <Tooltip
                                                    cursor={{ fill: '#f8fafc' }}
                                                    contentStyle={{ borderRadius: '8px', border: '1px solid #e2e8f0', boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1)' }}
                                                />
                                                <Bar dataKey="value" radius={[0, 4, 4, 0]} barSize={24}>
                                                    {dashboardData.stats[activeRegion] && dashboardData.stats[activeRegion].map((entry, index) => (
                                                        // Use Navy for main, Accent(Gold) for top 1
                                                        <Cell key={`cell-${index}`} fill={index === 0 ? '#f59e0b' : (regionColors[activeRegion] || '#1e3a8a')} />
                                                    ))}
                                                    <LabelList dataKey="value" position="right" formatter={(val) => `${val}%`} style={{ fontSize: '12px', fontWeight: 'bold', fill: '#64748b' }} />
                                                </Bar>
                                            </BarChart>
                                        </ResponsiveContainer>
                                    </div>
                                </div>
                            </div>

                            {/* Radar Chart */}
                            <div className="lg:col-span-1">
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 h-full flex flex-col relative overflow-hidden">
                                    <div className="absolute top-0 left-0 w-24 h-24 bg-primary/5 rounded-br-full pointer-events-none"></div>
                                    <div className="flex items-center justify-between mb-4 relative z-10">
                                        <div>
                                            <h3 className="font-bold text-gray-800 flex items-center gap-2">
                                                <div className="text-primary"><IconRadar className="w-5 h-5" /></div>
                                                สแกน 5 มิติ
                                            </h3>
                                        </div>
                                    </div>
                                    <div className="flex-1 min-h-[300px]">
                                        <ResponsiveContainer width="100%" height="100%">
                                            <RadarChart cx="50%" cy="50%" outerRadius="70%" data={radarData}>
                                                <PolarGrid stroke="#e2e8f0" />
                                                <PolarAngleAxis dataKey="subject" tick={{ fontSize: 12, fill: '#64748b', fontWeight: '500' }} />
                                                <PolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} />
                                                <Radar name="ประเทศ" dataKey="B" stroke="#cbd5e1" strokeWidth={2} fill="#cbd5e1" fillOpacity={0.2} />
                                                <Radar name={activeRegion === "National" ? "ภาพรวมประเทศ" : activeRegion} dataKey="A" stroke={regionColors[activeRegion] || "#1e3a8a"} strokeWidth={2} fill={regionColors[activeRegion] || "#1e3a8a"} fillOpacity={0.4} />
                                                <Tooltip />
                                            </RadarChart>
                                        </ResponsiveContainer>
                                    </div>
                                    <div className="mt-2 text-center">
                                        <span className="inline-block px-3 py-1 rounded-full bg-amber-50 text-amber-700 text-xs font-semibold border border-amber-100">
                                            {(() => {
                                                if (activeRegion === "National") return "📊 สรุปภาพรวมความต้องการระดับประเทศ";
                                                if (!radarData || radarData.length === 0) return "สรุปภาพรวม";
                                                const topDim = [...radarData].sort((a, b) => b.A - a.A)[0];
                                                const insights = {
                                                    'เศรษฐกิจ': '⚡ เน้นปากท้องและเศรษฐกิจ',
                                                    'การเมือง': '⚖️ เน้นความโปร่งใสและการเมือง',
                                                    'สิ่งแวดล้อม': '🌿 เน้นสิ่งแวดล้อมและมลพิษ',
                                                    'สังคม': '🏘️ เน้นสวัสดิการและความมั่นคงสังคม',
                                                    'การศึกษา': '📚 เน้นการศึกษาและพัฒนาทักษะ'
                                                };
                                                return insights[topDim.subject] || "สรุปภาพรวมในพื้นที่";
                                            })()}
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Sankey */}
                        <div className="fade-in" key={`sankey-${activeRegion}`}>
                            <SankeyDiagram flowData={dashboardData.flow} activeRegion={activeRegion} />
                        </div>

                        {/* Comments */}
                        <div className="grid grid-cols-1 fade-in" key={`mid-${activeRegion}`}>
                            <div className="w-full">
                                <div className="bg-white rounded-3xl p-6 shadow-sm border border-gray-100 flex flex-col">
                                    <div className="flex items-center justify-between mb-4">
                                        <h3 className="font-bold text-gray-800 flex items-center gap-2">
                                            <div className="text-primary"><IconMessageCircle size={20} /></div>
                                            เสียงจากคนท้องถิ่น
                                        </h3>
                                    </div>
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        {displayComments.map((comment, idx) => <CommentCard key={idx} data={comment} />)}
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Heatmap */}
                        <div className="fade-in" key={`heatmap-${activeRegion}`}>
                            <PolicyHeatmap data={dashboardData.heatmap[activeRegion] || []} policies={allPolicies} regionName={activeRegion} />
                        </div>
                    </main>

                    <footer className="mt-12 py-8 bg-white border-t border-gray-100 text-center">
                        <div className="flex flex-col items-center gap-4">
                            <img
                                src="https://voices-hometown.vercel.app/images/logo-locolvoice.png"
                                alt="Locals Voice Logo"
                                className="h-8 grayscale opacity-50 hover:grayscale-0 hover:opacity-100 transition-all"
                                onError={(e) => e.target.style.display = 'none'}
                            />
                            <p className="text-gray-400 text-sm">© 2026 Locals Voice Project. All rights reserved.</p>
                        </div>
                    </footer>
                </div>
            );
        };

        const root = document.getElementById('root');
        ReactDOM.render(<App />, root);
    </script>
</body>

</html>